<!-- Styles/CoreEditorTemplate.xaml 같은 곳 -->
<ResourceDictionary
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:items="clr-namespace:ArcGridOptimizer.ViewModels.Items">

    <Style TargetType="ContentControl" x:Key="ContentControl_HideWhenContentNull">
        <Setter Property="Visibility" Value="Visible"/>
        <Style.Triggers>
            <!-- Content가 null이면 숨김 -->
            <DataTrigger Binding="{Binding Content, RelativeSource={RelativeSource Self}}" Value="{x:Null}">
                <Setter Property="Visibility" Value="Hidden"/>
            </DataTrigger>

            <!-- Content(IsInitialized) == false면 숨김 -->
            <DataTrigger Binding="{Binding Content.IsInitialized, RelativeSource={RelativeSource Self}}" Value="False">
                <Setter Property="Visibility" Value="Hidden"/>
            </DataTrigger>
        </Style.Triggers>
    </Style>

    <!-- 키를 주고 쓰는 방식 -->
    <DataTemplate x:Key="CoreEditorTemplate" DataType="{x:Type items:Core}">
        <!-- 여기부터가 기존 Border 안의 내용 -->
        <Border>
            <StackPanel Orientation="Vertical" Margin="3">
                <ComboBox Margin="3"
                          ItemsSource="{Binding Source={StaticResource CoreTypePropertyValues}}"
                          SelectedItem="{Binding Grade, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                    <ComboBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding Converter={StaticResource Enum2DescCvt}}"
                                       TextAlignment="Center" VerticalAlignment="Center"/>
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                    <ComboBox.Style>
                        <Style TargetType="ComboBox">
                            <Setter Property="Effect">
                                <Setter.Value>
                                    <DropShadowEffect
                                        Color="{Binding Grade, Converter={StaticResource CoreGradeToColorCvt}}"
                                        BlurRadius="10" ShadowDepth="0"/>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </ComboBox.Style>
                </ComboBox>

                <TextBox Text="{Binding Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, Delay=50}"
                         Margin="3" Height="25" VerticalContentAlignment="Center"/>

                <TextBlock Text="코어 딜증 세팅" HorizontalAlignment="Center" Margin="3"/>

                <DataGrid ItemsSource="{Binding CoreValues}"
                          AutoGenerateColumns="False"
                          CanUserDeleteRows="False"
                          CanUserAddRows="False"
                          SelectionMode="Single"
                          SelectionUnit="FullRow">
                    <DataGrid.Style>
                        <Style TargetType="DataGrid" BasedOn="{StaticResource ThinDataGridStyle}">
                            <Style.Triggers>
                                <Trigger Property="IsKeyboardFocusWithin" Value="False">
                                    <Setter Property="SelectedItem" Value="{x:Null}"/>
                                    <Setter Property="SelectedIndex" Value="-1"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </DataGrid.Style>
                    <DataGrid.RowStyle>
                        <Style TargetType="DataGridRow"
                               BasedOn="{StaticResource SharedDataGridRowStyle}">
                            <Setter Property="Opacity" Value="1"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Enabled}" Value="False">
                                    <Setter Property="Opacity" Value="0.2"/>
                                    <Setter Property="IsHitTestVisible" Value="False"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </DataGrid.RowStyle>
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="달성 레벨"
                                            Binding="{Binding Level}" IsReadOnly="True" CanUserSort="False"
                                            ElementStyle="{StaticResource CenterTextBlock}"
                                            EditingElementStyle="{StaticResource CenterTextBox}"/>

                        <DataGridTemplateColumn Header="달성 우선순위">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <ComboBox Style="{StaticResource Combo_VisibleWhenSpecial}"
                                              ItemsSource="{Binding Source={StaticResource CoreEffLevelValues}}"
                                              SelectedItem="{Binding EffLevelType, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                                        <ComboBox.ItemTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Converter={StaticResource Enum2DescCvt}}"
                                                           TextAlignment="Center" VerticalAlignment="Center"/>
                                            </DataTemplate>
                                        </ComboBox.ItemTemplate>
                                    </ComboBox>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <DataGridTextColumn Header="달성 시 딜증" Width="*"
                                            Binding="{Binding Value}" CanUserSort="False"
                                            ElementStyle="{StaticResource CenterTextBlock_DisdableWhenSpecial}"
                                            EditingElementStyle="{StaticResource CenterTextBox_DisableWhenSpecial}"/>
                    </DataGrid.Columns>
                </DataGrid>
            </StackPanel>
        </Border>
    </DataTemplate>
</ResourceDictionary>
